<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Counter</title>
    <style>
        :root {
            /* Light theme (default) */
            --color-primary: #5B36F6;
            --color-primary-dark: #4A2DE0;
            --color-bg: #FFFFFF;
            --color-bg-secondary: #F9FAFB;
            --color-text: #111827;
            --color-text-muted: #6B7280;
            --color-border: #E5E7EB;
            --color-card: #FFFFFF;
            --color-shadow: rgba(0, 0, 0, 0.05);
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Border radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1.5rem;
            
            /* Typography */
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 2rem;
            --font-size-4xl: 2.5rem;
        }

        [data-theme="dark"] {
            --color-bg: #1E1E22;
            --color-bg-secondary: #2C2C31;
            --color-text: #E5E7EB;
            --color-text-muted: #9CA3AF;
            --color-border: #2C2C31;
            --color-card: #1E1E22;
            --color-shadow: rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.5;
            transition: background-color 0.3s, color 0.3s;
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        button {
            cursor: pointer;
            font-family: inherit;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            background-color: var(--color-primary);
            color: white;
            padding: var(--spacing-md) var(--spacing-xl);
            box-shadow: 0 2px 10px var(--color-shadow);
            z-index: 100;
        }

        .header-container {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            font-weight: 700;
            font-size: var(--font-size-lg);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background-color: white;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-primary);
            font-weight: bold;
        }

        .nav {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
        }

        .nav-link {
            font-size: var(--font-size-sm);
            transition: opacity 0.2s;
        }

        .nav-link:hover {
            opacity: 0.8;
        }

        .user-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main content */
        .main {
            max-width: 1100px;
            margin: 0 auto;
            padding: var(--spacing-2xl) var(--spacing-xl);
        }

        .hero {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .hero-title {
            font-size: clamp(28px, 5vw, 42px);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }

        .hero-subtitle {
            font-size: var(--font-size-lg);
            color: var(--color-text-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Input card */
        .input-card {
            background-color: var(--color-card);
            border-radius: var(--radius-xl);
            box-shadow: 0 4px 12px var(--color-shadow);
            margin-bottom: var(--spacing-2xl);
            position: relative;
        }

        .input-container {
            position: relative;
        }

        .textarea {
            width: 100%;
            min-height: 200px;
            padding: var(--spacing-xl);
            border: none;
            border-radius: var(--radius-xl);
            background-color: var(--color-card);
            color: var(--color-text);
            font-size: var(--font-size-base);
            resize: vertical;
            outline: none;
            line-height: 1.6;
            direction: auto;
        }

        .textarea::placeholder {
            color: var(--color-text-muted);
        }

        .copy-icon {
            position: absolute;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            background-color: var(--color-bg-secondary);
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--color-border);
            color: var(--color-text-muted);
            transition: all 0.2s;
        }

        .copy-icon:hover {
            background-color: var(--color-primary);
            color: white;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-xl);
            border-top: 1px solid var(--color-border);
        }

        .pill-button {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: 9999px;
            font-size: var(--font-size-sm);
            color: var(--color-text);
            transition: all 0.2s;
        }

        .pill-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px var(--color-shadow);
        }

        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: var(--spacing-xs);
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--color-shadow);
            padding: var(--spacing-sm);
            z-index: 10;
            min-width: 160px;
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            display: block;
            width: 100%;
            text-align: left;
            padding: var(--spacing-sm) var(--spacing-md);
            background: none;
            border: none;
            color: var(--color-text);
            font-size: var(--font-size-sm);
            border-radius: var(--radius-sm);
        }

        .dropdown-item:hover {
            background-color: var(--color-bg-secondary);
        }

        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-2xl);
        }

        .stat-card {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            position: relative;
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
            margin-bottom: var(--spacing-xs);
        }

        .stat-value {
            font-size: var(--font-size-2xl);
            font-weight: 600;
        }

        .stat-tooltip {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-muted);
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: help;
        }

        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--color-text);
            color: var(--color-bg);
            text-align: center;
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm);
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: var(--font-size-sm);
        }

        .stat-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Tabs */
        .tabs {
            margin-bottom: var(--spacing-xl);
        }

        .tab-header {
            display: flex;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--spacing-lg);
        }

        .tab-button {
            padding: var(--spacing-md) var(--spacing-lg);
            background: none;
            border: none;
            color: var(--color-text-muted);
            font-size: var(--font-size-base);
            position: relative;
        }

        .tab-button.active {
            color: var(--color-primary);
            font-weight: 500;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .overview-text {
            font-size: var(--font-size-lg);
            color: var(--color-text);
            line-height: 1.6;
        }

        .density-controls {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .checkbox-label, .input-label {
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }

        .length-input {
            width: 60px;
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            background-color: var(--color-card);
            color: var(--color-text);
        }

        .density-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-lg);
        }

        .density-table th, .density-table td {
            padding: var(--spacing-sm);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        .density-table th {
            font-weight: 600;
            color: var(--color-text-muted);
            font-size: var(--font-size-sm);
        }

        .case-tools {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .case-button {
            padding: var(--spacing-md) var(--spacing-lg);
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            color: var(--color-text);
            font-size: var(--font-size-base);
            transition: all 0.2s;
        }

        .case-button:hover {
            background-color: var(--color-bg-secondary);
        }

        /* Footer */
        .footer {
            background-color: var(--color-bg-secondary);
            padding: var(--spacing-xl);
            text-align: center;
            margin-top: var(--spacing-2xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-text {
            color: var(--color-text-muted);
            font-size: var(--font-size-sm);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--color-text-muted);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-sm);
            cursor: pointer;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--color-primary);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-container {
                padding: 0 var(--spacing-md);
            }
            
            .nav {
                gap: var(--spacing-md);
            }
            
            .nav-link:not(:last-child) {
                display: none;
            }
            
            .main {
                padding: var(--spacing-xl) var(--spacing-md);
            }
            
            .toolbar {
                padding: var(--spacing-md);
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
            
            .density-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .footer {
                flex-direction: column;
                gap: var(--spacing-md);
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        button:focus-visible, 
        textarea:focus-visible, 
        input:focus-visible {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">wc</div>
                <span>wordcount</span>
            </div>
            <nav class="nav">
                <a href="#" class="nav-link">Docs</a>
                <a href="#" class="nav-link">API</a>
                <a href="#" class="nav-link">Extensions</a>
                <a href="#" class="nav-link">Help</a>
                <div class="user-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </div>
            </nav>
        </div>
    </header>

    <main class="main">
        <section class="hero">
            <h1 class="hero-title">Free Word Counter</h1>
            <p class="hero-subtitle">Analyze text quickly—words, characters, sentences, reading time, and more.</p>
        </section>

        <section class="input-card">
            <div class="input-container">
                <textarea 
                    class="textarea" 
                    placeholder="Paste or type your text here…"
                    data-testid="input"
                    dir="auto"
                ></textarea>
                <button class="copy-icon" aria-label="Copy text">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                </button>
            </div>
            <div class="toolbar">
                <button class="pill-button" data-action="copy">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                    Copy
                </button>
                <button class="pill-button" data-action="random">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Random
                </button>
                <div class="dropdown">
                    <button class="pill-button" data-action="change">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
                        </svg>
                        Change
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" data-case="uppercase">UPPERCASE</button>
                        <button class="dropdown-item" data-case="lowercase">lowercase</button>
                        <button class="dropdown-item" data-case="titlecase">Title Case</button>
                        <button class="dropdown-item" data-case="sentencecase">Sentence case</button>
                    </div>
                </div>
                <button class="pill-button" data-action="delete">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18"></path>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Delete
                </button>
                <div class="dropdown">
                    <button class="pill-button" data-action="more">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="1"></circle>
                            <circle cx="12" cy="5" r="1"></circle>
                            <circle cx="12" cy="19" r="1"></circle>
                        </svg>
                        More
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" data-cleanup="remove-extra-spaces">Remove extra spaces</button>
                        <button class="dropdown-item" data-cleanup="trim-lines">Trim lines</button>
                        <button class="dropdown-item" data-cleanup="deduplicate-lines">Deduplicate lines</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Words</div>
                <div class="stat-value" data-testid="stat-words">0</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">Words are counted by splitting text on spaces and punctuation</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Characters (with spaces)</div>
                <div class="stat-value" data-testid="stat-characters-with-spaces">0</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">All characters including spaces, tabs, and line breaks</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Characters (no spaces)</div>
                <div class="stat-value" data-testid="stat-characters-no-spaces">0</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">Characters excluding spaces, tabs, and line breaks</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Sentences</div>
                <div class="stat-value" data-testid="stat-sentences">0</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">Sentences are detected by punctuation marks (. ! ?)</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Paragraphs</div>
                <div class="stat-value" data-testid="stat-paragraphs">0</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">Paragraphs are separated by blank lines</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Lines</div>
                <div class="stat-value" data-testid="stat-lines">0</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">Lines are counted by the number of line breaks</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Reading Time</div>
                <div class="stat-value" data-testid="stat-reading-time">0 min</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">Based on 200 words per minute reading speed</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg. Word Length</div>
                <div class="stat-value" data-testid="stat-avg-word-length">0</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">Average number of characters per word</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Longest Word</div>
                <div class="stat-value" data-testid="stat-longest-word">-</div>
                <div class="stat-tooltip">?
                    <span class="tooltip-text">The longest word found in the text</span>
                </div>
            </div>
        </section>

        <section class="tabs">
            <div class="tab-header">
                <button class="tab-button active" data-tab="overview">Overview</button>
                <button class="tab-button" data-tab="keyword-density">Keyword Density</button>
                <button class="tab-button" data-tab="case-tools">Case Tools</button>
            </div>
            <div class="tab-content active" data-tab-content="overview">
                <p class="overview-text" data-testid="overview-text">Start typing to see analysis.</p>
            </div>
            <div class="tab-content" data-tab-content="keyword-density">
                <div class="density-controls">
                    <div class="control-group">
                        <input type="checkbox" id="stopwords" checked>
                        <label for="stopwords" class="checkbox-label">Ignore common words</label>
                    </div>
                    <div class="control-group">
                        <label for="min-length" class="input-label">Min. word length:</label>
                        <input type="number" id="min-length" class="length-input" value="3" min="1">
                    </div>
                    <button class="pill-button" data-action="copy-csv">Copy CSV</button>
                </div>
                <table class="density-table" data-testid="table-density">
                    <thead>
                        <tr>
                            <th>Word</th>
                            <th>Count</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="tab-content" data-tab-content="case-tools">
                <div class="case-tools">
                    <button class="case-button" data-case="uppercase">UPPERCASE</button>
                    <button class="case-button" data-case="lowercase">lowercase</button>
                    <button class="case-button" data-case="titlecase">Title Case</button>
                    <button class="case-button" data-case="sentencecase">Sentence case</button>
                    <button class="case-button" data-cleanup="remove-extra-spaces">Remove extra spaces</button>
                    <button class="case-button" data-cleanup="trim-lines">Trim lines</button>
                    <button class="case-button" data-cleanup="deduplicate-lines">Deduplicate lines</button>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p class="footer-text">Made with ❤️ · No data leaves your browser</p>
        <button class="theme-toggle" data-testid="toggle-theme">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="theme-icon">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <span class="theme-text">Light mode</span>
        </button>
    </footer>

    <div class="toast" id="toast">Copied!</div>

    <script>
        (function() {
            // DOM Elements
            const textarea = document.querySelector('.textarea');
            const copyIcon = document.querySelector('.copy-icon');
            const toolbar = document.querySelector('.toolbar');
            const statsGrid = document.querySelector('.stats-grid');
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            const themeToggle = document.querySelector('.theme-toggle');
            const themeIcon = document.querySelector('.theme-icon');
            const themeText = document.querySelector('.theme-text');
            const toast = document.getElementById('toast');
            const stopwordsCheckbox = document.getElementById('stopwords');
            const minLengthInput = document.getElementById('min-length');
            const densityTable = document.querySelector('.density-table tbody');
            
            // State
            let debounceTimer;
            const DEBOUNCE_DELAY = 150;
            const READING_SPEED = 200; // words per minute
            
            // Sample texts for random button
            const sampleTexts = [
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc eu nisl. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc eu nisl.",
                "The quick brown fox jumps over the lazy dog. This sentence contains every letter in the English alphabet. Pack my box with five dozen liquor jugs! How vexingly quick daft zebras jump.",
                "Hello world! This is a word counter application. It analyzes text and provides statistics like word count, character count, sentence count, and more. Try typing or pasting your own text to see it in action.",
                "In the beginning, God created the heavens and the earth. Now the earth was formless and empty, darkness was over the surface of the deep, and the Spirit of God was hovering over the waters. And God said, 'Let there be light,' and there was light."
            ];
            
            // Common English stopwords
            const stopwords = new Set([
                'a', 'an', 'and', 'are', 'as', 'at', 'be', 'but', 'by', 'for', 
                'if', 'in', 'into', 'is', 'it', 'no', 'not', 'of', 'on', 'or', 
                'such', 'that', 'the', 'their', 'then', 'there', 'these', 'they', 
                'this', 'to', 'was', 'will', 'with', 'i', 'you', 'he', 'she', 'we', 'my'
            ]);
            
            // Initialize the application
            function init() {
                // Set up event listeners
                setupEventListeners();
                
                // Set initial theme based on user preference or localStorage
                setInitialTheme();
                
                // Analyze empty text to initialize stats
                analyzeText('');
            }
            
            // Set up all event listeners
            function setupEventListeners() {
                // Text input with debouncing
                textarea.addEventListener('input', () => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        analyzeText(textarea.value);
                    }, DEBOUNCE_DELAY);
                });
                
                // Copy icon click
                copyIcon.addEventListener('click', copyText);
                
                // Toolbar buttons
                toolbar.addEventListener('click', (e) => {
                    const button = e.target.closest('button');
                    if (!button) return;
                    
                    const action = button.dataset.action;
                    if (!action) return;
                    
                    switch(action) {
                        case 'copy':
                            copyText();
                            break;
                        case 'random':
                            insertRandomText();
                            break;
                        case 'change':
                            // Handled by dropdown
                            break;
                        case 'delete':
                            clearText();
                            break;
                        case 'more':
                            // Handled by dropdown
                            break;
                    }
                });
                
                // Dropdown menus
                document.querySelectorAll('.dropdown').forEach(dropdown => {
                    dropdown.addEventListener('click', (e) => {
                        const button = e.target.closest('button');
                        if (button && button.dataset.action) {
                            const menu = dropdown.querySelector('.dropdown-menu');
                            menu.classList.toggle('show');
                            e.stopPropagation();
                        }
                    });
                });
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', () => {
                    document.querySelectorAll('.dropdown-menu').forEach(menu => {
                        menu.classList.remove('show');
                    });
                });
                
                // Case change dropdown items
                document.querySelectorAll('[data-case]').forEach(item => {
                    item.addEventListener('click', (e) => {
                        changeCase(e.target.dataset.case);
                    });
                });
                
                // Cleanup dropdown items
                document.querySelectorAll('[data-cleanup]').forEach(item => {
                    item.addEventListener('click', (e) => {
                        cleanupText(e.target.dataset.cleanup);
                    });
                });
                
                // Tab switching
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const tab = button.dataset.tab;
                        switchTab(tab);
                    });
                });
                
                // Theme toggle
                themeToggle.addEventListener('click', toggleTheme);
                
                // Keyword density controls
                stopwordsCheckbox.addEventListener('change', updateKeywordDensity);
                minLengthInput.addEventListener('input', updateKeywordDensity);
                
                // Case tools buttons
                document.querySelectorAll('.case-tools [data-case]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        changeCase(e.target.dataset.case);
                    });
                });
                
                // Cleanup tools buttons
                document.querySelectorAll('.case-tools [data-cleanup]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        cleanupText(e.target.dataset.cleanup);
                    });
                });
                
                // Copy CSV button
                document.querySelector('[data-action="copy-csv"]').addEventListener('click', copyDensityCSV);
            }
            
            // Analyze the text and update all statistics
            function analyzeText(text) {
                // Word count
                const words = getWords(text);
                const wordCount = words.length;
                
                // Character counts
                const charsWithSpaces = text.length;
                const charsNoSpaces = text.replace(/\s/g, '').length;
                
                // Sentence count
                const sentences = getSentences(text);
                const sentenceCount = sentences.length;
                
                // Paragraph count
                const paragraphs = getParagraphs(text);
                const paragraphCount = paragraphs.length;
                
                // Line count
                const lineCount = text ? text.split('\n').length : 0;
                
                // Reading time
                const readingTime = calculateReadingTime(wordCount);
                
                // Average word length
                const avgWordLength = wordCount > 0 
                    ? words.reduce((sum, word) => sum + word.length, 0) / wordCount 
                    : 0;
                
                // Longest word
                const longestWord = wordCount > 0 
                    ? words.reduce((longest, word) => word.length > longest.length ? word : longest, words[0])
                    : '';
                
                // Update the DOM with calculated values
                updateStat('words', wordCount);
                updateStat('characters-with-spaces', charsWithSpaces);
                updateStat('characters-no-spaces', charsNoSpaces);
                updateStat('sentences', sentenceCount);
                updateStat('paragraphs', paragraphCount);
                updateStat('lines', lineCount);
                updateStat('reading-time', readingTime);
                updateStat('avg-word-length', avgWordLength.toFixed(1));
                updateStat('longest-word', longestWord);
                
                // Update overview text
                updateOverviewText(wordCount, sentenceCount, readingTime);
                
                // Update keyword density
                updateKeywordDensity();
            }
            
            // Get words from text
            function getWords(text) {
                if (!text.trim()) return [];
                
                // Match words with apostrophes and hyphens
                return text.match(/[\p{L}\p{M}]+(?:['’-][\p{L}\p{M}]+)*/gu) || [];
            }
            
            // Get sentences from text
            function getSentences(text) {
                if (!text.trim()) return [];
                
                // Basic sentence splitting, avoiding common abbreviations
                const sentences = text.split(/(?<!\b(?:Mr|Mrs|Ms|Dr|Prof|Rev|Gen|Sen|Rep|St|Ave|Blvd|Rd|Jan|Feb|Mar|Apr|Jun|Jul|Aug|Sep|Oct|Nov|Dec))[.!?]+[\s\n]+/);
                return sentences.filter(s => s.trim().length > 0);
            }
            
            // Get paragraphs from text
            function getParagraphs(text) {
                if (!text.trim()) return [];
                
                return text.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            }
            
            // Calculate reading time
            function calculateReadingTime(wordCount) {
                const minutes = Math.floor(wordCount / READING_SPEED);
                const seconds = Math.floor((wordCount % READING_SPEED) / (READING_SPEED / 60));
                
                if (minutes === 0) return `${seconds} sec`;
                if (seconds === 0) return `${minutes} min`;
                return `${minutes} min ${seconds} sec`;
            }
            
            // Update a statistic in the DOM
            function updateStat(stat, value) {
                const element = document.querySelector(`[data-testid="stat-${stat}"]`);
                if (element) {
                    element.textContent = value;
                }
            }
            
            // Update the overview text
            function updateOverviewText(wordCount, sentenceCount, readingTime) {
                const overviewElement = document.querySelector('[data-testid="overview-text"]');
                
                if (wordCount === 0) {
                    overviewElement.textContent = 'Start typing to see analysis.';
                    return;
                }
                
                let overviewText = `${wordCount} word${wordCount !== 1 ? 's' : ''}`;
                
                if (sentenceCount > 0) {
                    overviewText += ` across ${sentenceCount} sentence${sentenceCount !== 1 ? 's' : ''}`;
                }
                
                overviewText += `; ~${readingTime} read.`;
                
                overviewElement.textContent = overviewText;
            }
            
            // Update the keyword density table
            function updateKeywordDensity() {
                const text = textarea.value;
                if (!text.trim()) {
                    densityTable.innerHTML = '<tr><td colspan="3">No text to analyze</td></tr>';
                    return;
                }
                
                const ignoreStopwords = stopwordsCheckbox.checked;
                const minLength = parseInt(minLengthInput.value) || 3;
                
                const words = getWords(text)
                    .map(word => word.toLowerCase().replace(/^[^\p{L}\p{M}]+|[^\p{L}\p{M}]+$/gu, ''))
                    .filter(word => word.length >= minLength);
                
                if (words.length === 0) {
                    densityTable.innerHTML = '<tr><td colspan="3">No words meeting the criteria</td></tr>';
                    return;
                }
                
                // Count word frequencies
                const wordCounts = {};
                words.forEach(word => {
                    if (ignoreStopwords && stopwords.has(word)) return;
                    wordCounts[word] = (wordCounts[word] || 0) + 1;
                });
                
                // Convert to array and sort by frequency (then alphabetically)
                const wordEntries = Object.entries(wordCounts)
                    .sort((a, b) => {
                        if (b[1] !== a[1]) return b[1] - a[1];
                        return a[0].localeCompare(b[0]);
                    })
                    .slice(0, 10); // Top 10 only
                
                // Calculate total words for percentage
                const total = wordEntries.reduce((sum, [_, count]) => sum + count, 0);
                
                // Update the table
                densityTable.innerHTML = '';
                wordEntries.forEach(([word, count]) => {
                    const percentage = ((count / total) * 100).toFixed(1);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${word}</td>
                        <td>${count}</td>
                        <td>${percentage}%</td>
                    `;
                    densityTable.appendChild(row);
                });
            }
            
            // Copy text to clipboard
            function copyText() {
                if (!textarea.value.trim()) return;
                
                textarea.select();
                try {
                    navigator.clipboard.writeText(textarea.value);
                    showToast('Copied to clipboard!');
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    // Fallback for older browsers
                    document.execCommand('copy');
                    showToast('Copied to clipboard!');
                }
            }
            
            // Copy keyword density as CSV
            function copyDensityCSV() {
                const rows = Array.from(densityTable.querySelectorAll('tr'));
                if (rows.length === 0 || rows[0].textContent.includes('No text')) return;
                
                let csvContent = "Word,Count,Percentage\n";
                rows.forEach(row => {
                    const cells = Array.from(row.querySelectorAll('td'));
                    if (cells.length === 3) {
                        const word = cells[0].textContent;
                        const count = cells[1].textContent;
                        const percentage = cells[2].textContent;
                        csvContent += `"${word}",${count},${percentage}\n`;
                    }
                });
                
                try {
                    navigator.clipboard.writeText(csvContent);
                    showToast('CSV copied to clipboard!');
                } catch (err) {
                    console.error('Failed to copy CSV: ', err);
                }
            }
            
            // Insert random sample text
            function insertRandomText() {
                const randomIndex = Math.floor(Math.random() * sampleTexts.length);
                textarea.value = sampleTexts[randomIndex];
                analyzeText(textarea.value);
            }
            
            // Clear the textarea
            function clearText() {
                textarea.value = '';
                analyzeText('');
            }
            
            // Change text case
            function changeCase(caseType) {
                if (!textarea.value.trim()) return;
                
                switch(caseType) {
                    case 'uppercase':
                        textarea.value = textarea.value.toUpperCase();
                        break;
                    case 'lowercase':
                        textarea.value = textarea.value.toLowerCase();
                        break;
                    case 'titlecase':
                        textarea.value = toTitleCase(textarea.value);
                        break;
                    case 'sentencecase':
                        textarea.value = toSentenceCase(textarea.value);
                        break;
                }
                
                analyzeText(textarea.value);
            }
            
            // Convert text to title case
            function toTitleCase(text) {
                return text.replace(/\b\p{L}\p{M}*/gu, word => 
                    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
                );
            }
            
            // Convert text to sentence case
            function toSentenceCase(text) {
                return text.replace(/(^\s*|[.!?]\s+)(\p{L}\p{M}*)/gu, (match, prefix, firstLetter) => 
                    prefix + firstLetter.toUpperCase()
                );
            }
            
            // Clean up text based on action
            function cleanupText(action) {
                if (!textarea.value.trim()) return;
                
                switch(action) {
                    case 'remove-extra-spaces':
                        textarea.value = textarea.value.replace(/\s+/g, ' ').trim();
                        break;
                    case 'trim-lines':
                        textarea.value = textarea.value.split('\n').map(line => line.trim()).join('\n');
                        break;
                    case 'deduplicate-lines':
                        const lines = textarea.value.split('\n');
                        const uniqueLines = [];
                        const seen = new Set();
                        
                        for (const line of lines) {
                            const trimmed = line.trim();
                            if (!seen.has(trimmed)) {
                                seen.add(trimmed);
                                uniqueLines.push(line);
                            }
                        }
                        textarea.value = uniqueLines.join('\n');
                        break;
                }
                
                analyzeText(textarea.value);
            }
            
            // Switch between tabs
            function switchTab(tabName) {
                // Update tab buttons
                tabButtons.forEach(button => {
                    button.classList.toggle('active', button.dataset.tab === tabName);
                });
                
                // Update tab contents
                tabContents.forEach(content => {
                    content.classList.toggle('active', content.dataset.tabContent === tabName);
                });
                
                // If switching to keyword density tab, update it
                if (tabName === 'keyword-density') {
                    updateKeywordDensity();
                }
            }
            
            // Set initial theme based on user preference
            function setInitialTheme() {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
                    themeText.textContent = 'Dark mode';
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                    themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
                    themeText.textContent = 'Light mode';
                }
            }
            
            // Toggle between light and dark themes
            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                
                if (currentTheme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                    themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
                    themeText.textContent = 'Light mode';
                } else {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                    themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
                    themeText.textContent = 'Dark mode';
                }
            }
            
            // Show a toast notification
            function showToast(message) {
                toast.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }
            
            // Initialize the application
            init();
        })();
    </script>
</body>
</html>
